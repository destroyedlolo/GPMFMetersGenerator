/* QualityGaphic
 * Generate quality gaphic
 */

#include "QualityGfx.h"

#include <cstdio>
#include <cstdlib>
#include <cerrno>
#include <cstring>
#include <cmath>

/* GIMP RGBA C-Source image dump (Satellite.c) */

static struct {
  int  	 width;
  int  	 height;
  int  	 bytes_per_pixel; /* 2:RGB16, 3:RGB, 4:RGBA */ 
  unsigned char 	 pixel_data[40 * 40 * 4 + 1];
} imgSatellite = {
  40, 40, 4,
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\315\315\315G\314\314\314\260\277"
  "\277\277\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\315\315\315G\314\314\314\367\314\314\314\377\314\314\314\270\277"
  "\277\277\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\315\315"
  "\315G\314\314\314\367\314\314\314\377\314\314\314\377\314\314\314\377\314"
  "\314\314\270\277\277\277\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\315\315"
  "\315G\314\314\314\367\314\314\314\377\314\314\314\377\314\314\314\377\314"
  "\314\314\377\314\314\314\377\314\314\314\270\277\277\277\010\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\315\315\315G\314\314\314\367\314\314\314\377\314\314\314\377\314"
  "\314\314\377\314\314\314\377\314\314\314\377\314\314\314\377\314\314\314"
  "\377\314\314\314\270\277\277\277\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\313\313\313I\314\314\314\370\314"
  "\314\314\377\314\314\314\377\314\314\314\377\314\314\314\377\314\314\314"
  "\377\314\314\314\377\314\314\314\377\314\314\314\377\314\314\314\377\313"
  "\313\313\250\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\334\202jt\350\177c\365\315\313\312\377\314\314\314\377\314\314"
  "\314\377\314\314\314\377\314\314\314\377\314\314\314\377\314\314\314\377"
  "\314\314\314\377\314\314\314\377\314\314\314\362\312\312\312:\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\264\264\264G\270\255"
  "\252\367\353gC\370\353{]\367\315\312\312\377\314\314\314\377\314\314\314"
  "\377\314\314\314\377\314\314\314\377\314\314\314\377\314\314\314\377\314"
  "\314\314\364\312\312\312?\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\264\264\264G\263\263\263\367\263\263\263\377\267\255\252"
  "\377\353gC\370\353{]\367\315\312\312\377\314\314\314\377\314\314\314\377"
  "\314\314\314\377\314\314\314\377\314\314\314\364\312\312\312?\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\313\313\313N\322\322\322\021\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\265\265"
  "\265&\263\263\263\370\263\263\263\377\263\263\263\377\263\263\263\377\267"
  "\255\252\377\354gC\367\352z]\370\315\312\312\377\314\314\314\377\314\314"
  "\314\377\314\314\314\364\312\312\312?\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\313\313\313\205\314\314\314\377\314\314\314\317\311\311\311"
  "\023q\345\320Fo\345\317\236q\344\317\243p\344\316T\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\263\263\263\200\263\263\263\377\263\263\263\377\263\263"
  "\263\377\263\263\263\377\267\255\252\377\353gC\370\352z]\370\315\312\312"
  "\377\314\314\314\364\312\312\312?\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\302\302\302\253\314\314\314\377\314\314\314\377\314\314\314\377"
  "\217\335\316\311p\345\317\376p\345\317\377p\345\317\377p\345\317\376\270"
  "\230w\220\377U\000\003\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\263\263\263\200\263\263"
  "\263\377\263\263\263\377\263\263\263\377\263\263\263\377\267\255\252\377"
  "\354gD\370\350\201e\362\312\312\312?\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\275\275\275\204\263\263\263\377\305\305\305\377\314\314\314"
  "\377\225\333\315\335p\345\317\377p\345\317\377p\345\317\377p\345\317\376"
  "\270\231v\353\371T(\377\371S'\250\377@@\004\000\000\000\000\000\000\000\000\000\000\000\000\065\330"
  "\271\217u\306\266\377\263\263\263\377\263\263\263\377\263\263\263\377\263"
  "\263\263\377\270\255\252\363\330\201ia\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\301\301\301!\267\267\267\366\264\264\264\377\224\331"
  "\314\344p\345\317\377p\345\317\377p\345\317\377q\344\316\377\276\224q\376"
  "\371T(\377\371T(\377\371T(\377\371S'\250\377@@\004\000\000\000\000\064\330\272\210\065"
  "\330\271\377\065\330\272}\263\263\263\200\263\263\263\377\263\263\263\377"
  "\263\263\263\364\262\262\262?\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\272\272\272%v\324\302\356p\345\317\377p\345"
  "\317\377p\345\317\377q\344\316\377\276\223q\377\371T(\377\371T(\377\371T"
  "(\377\371T(\377\371T(\377\371S'\242:\326\266\211\065\330\271\377\065\330\272"
  "}\000\000\000\000\000\000\000\000\263\263\263\200\263\263\263\364\262\262\262?\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000M\335"
  "\303wW\340\306\376p\345\317\377p\345\317\377q\344\316\377\276\223q\377\371"
  "T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\262\204"
  "\\\376;\324\264}\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\260\260\260\035\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000E\334\277\333W\337\306\377p\345\317\377q\344\316\377\276\223q\377\371"
  "T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T("
  "\377\371T(\377\371S'\250\377@@\004\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000E\333\277\336D\334\276\377p\345\317\376\274\222q\377\371T(\377\371"
  "T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T("
  "\377\371T(\377\371T(\377\371S'\250\377@@\004\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000M\334\303\214\065\330\271\377\231\240\203\371\371T(\377\371T(\377"
  "\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371"
  "T(\377\371T(\377\371T(\377\371T(\377\352b\071\256\266\222m\007\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\221\240\200\316\345G(\377\360N(\377\371T(\377"
  "\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371"
  "T(\377\371T(\377\371T(\377\356a\067\377\210\313\262\377\222\301\246\337\266"
  "\266m\007\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377f\000\005\353K'\334\345G(\377\357M"
  "(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T(\377"
  "\371T(\377\371T(\377\355a\067\377\207\315\264\377p\345\317\377p\345\317\377"
  "\233\271\234\313\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377\177\000\004\353"
  "K'\334\345G(\377\357M(\377\371T(\377\371T(\377\371T(\377\371T(\377\371T("
  "\377\371T(\377\371T(\377\356a\067\377\210\315\264\377p\345\317\377p\345\317"
  "\377}\326\275\374\255\241~A\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\377U\000\006\351J'\335\345G(\377\360N(\377\371T(\377\371T(\377\371T(\377\371"
  "T(\377\371T(\377\356a\067\377\210\315\263\377p\345\317\377p\345\317\377}\331"
  "\300\374\255\241~A\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\263\263\263%\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000?\325\263\221\322\\;\377\345G(\377\360N(\377\371T(\377\371"
  "T(\377\371T(\377\356a\067\377\210\315\264\377p\345\317\377p\345\317\377z\342"
  "\316\377\302\322\317\370\327\327\327\040\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\265\265\265H\263\263"
  "\263\367\262\262\262\210\000\000\000\000\000\000\000\000\064\330\272\210\065\330\271\377?\322"
  "\260\201\353K'\334\345G(\377\357M(\377\371T(\377\356a\067\377\210\315\263"
  "\377p\345\317\377p\345\317\377z\342\316\377\277\317\314\377\325\325\325\377"
  "\345\345\345\320\344\344\344\023X\340\305KW\340\307\214Y\337\306yU\332\277"
  "\060\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\264\264\264G\263\263\263\367\263"
  "\263\263\377\263\263\263\377\262\262\262\210\064\330\272\210\065\330\271\377"
  "\065\330\272}\000\000\000\000\377U\000\006\353K'\334\345G(\377\335^<\377\210\313\262\377"
  "p\345\317\377p\345\317\377z\342\316\377\277\317\314\377\325\325\325\377\345"
  "\345\345\377\222\343\324\377k\344\315\376p\345\317\377p\345\317\377p\345"
  "\317\377p\345\317\377d\342\312\353T\335\302C\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\334\202lt\270"
  "\256\253\370\263\263\263\377\263\263\263\377\263\263\263\377\263\263\263"
  "\377t\306\266\377\065\330\271|\000\000\000\000\000\000\000\000\000\000\000\000\377U\000\006\324bA\340"
  "B\325\271\377U\337\304\377p\345\317\377}\331\300\374\304\324\321\367\325"
  "\325\325\377\345\345\345\377\177\336\314\377K\335\301\377S\337\304\377a\342"
  "\311\377p\345\317\377p\345\317\377p\345\317\377p\345\317\377k\344\315\375"
  "\\\340\314\031\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\315\315\315G\350\200d\366\355gC\366\267\255\252\377\263\263"
  "\263\377\263\263\263\377\263\263\263\377\263\263\263\377\262\262\262\210"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\263\263f\012Y\312\255\372\065\330\271\377"
  "^\326\273\376\255\241~A\327\327\327\040\345\345\345\317q\323\277\377\062\324"
  "\265\377\065\330\271\377\065\330\271\377\065\330\271\377@\332\275\377_\341\311"
  "\377p\345\317\377m\345\316\376X\342\306k\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\315\315\315G\314\314\314\367\315"
  "\313\312\377\350~a\371\355e@\367\270\254\251\377\263\263\263\377\263\263"
  "\263\377\263\263\263\377\263\263\263\377\262\262\262\210\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\252\252U\014c\303\246\364\225\241\201o\000\000\000\000\000\000\000\000\314"
  "\345\345\024\037\276\240\376\060\323\263\377\065\330\271\377\065\330\271\377\065"
  "\330\271\377\065\330\271\377\065\330\271\377V\337\305\372X\342\306k\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\315\315"
  "\315G\314\314\314\367\314\314\314\377\314\314\314\377\315\313\312\377\350"
  "~a\371\356fA\370\270\254\251\377\263\263\263\377\263\263\263\377\263\263"
  "\263\377\263\263\263\362\263\263\263\036\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000)\311\252K\031\272\233\377,\317\260\377\065\330"
  "\271\377\065\330\271\377\065\330\271\377\065\330\271\377\065\330\271\364\064\327"
  "\267@\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\315\315\315G\314\314\314\367\314\314\314\377\314\314\314\377\314\314"
  "\314\377\314\314\314\377\315\313\312\377\350~a\371\355e@\367\270\254\251"
  "\377\263\263\263\377\263\263\263\364\262\262\262?\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000%\306\246\212\031\272\233"
  "\377'\311\252\377\065\330\271\377\065\330\271\377\065\330\271\377\066\326\267"
  "\370L\236\217y\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\315\315\315G\314\314\314\367\314\314\314\377\314\314\314\377"
  "\314\314\314\377\314\314\314\377\314\314\314\377\314\314\314\377\315\313"
  "\312\377\350~a\371\355e@\367\270\254\251\365\262\262\262?\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000%\307\247"
  "|\031\272\233\377\037\300\241\377\065\330\271\377\065\330\271\377\065\330\271"
  "\364L\240\220|fff\367fff\031\373T*=\371T(\213\000\000\000\000\371T'\211\373R)>\000\000"
  "\000\000\371U(\307\313\313\313I\314\314\314\370\314\314\314\377\314\314\314\377"
  "\314\314\314\377\314\314\314\377\314\314\314\377\314\314\314\377\314\314"
  "\314\377\314\314\314\377\315\313\312\377\350\201e\362\332\201ia\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000&\303\243/\032\273\233\377\031\272\233\377.\322\262\377\065\330\271\364"
  "\064\327\267@\000\000\000\000fff\031\000\000\000\001\372T(\224\371T)v\000\000\000\000\370T(\300\373"
  "U(\071\377Z-\021\371T(\345\314\314\314\257\314\314\314\377\314\314\314\377"
  "\314\314\314\377\314\314\314\377\314\314\314\377\314\314\314\377\314\314"
  "\314\377\314\314\314\377\314\314\314\377\314\314\314\362\312\312\312:\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\036\300\241\354\031\272\233\377\036\300\240\375"
  "\062\331\274=\000\000\000\000\000\000\000\000\373T*=\372T(\224\371T(\325\377U+\014\365X'\032"
  "\372T(\350\377U+\006\367R)D\372U(\273\325\325\325\006\313\313\313\262\314\314"
  "\314\377\314\314\314\377\314\314\314\377\314\314\314\377\314\314\314\377"
  "\314\314\314\377\314\314\314\377\314\314\314\364\312\312\312?\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000#\314\251A\034\274\235\375$\306\246p\000\000\000\000\000"
  "\000\000\000\000\000\000\000\371T(\213\371T)v\377U+\014\377\000\000\001\371T(\256\371T(y\000\000\000"
  "\000\370S'\234\370U(l\000\000\000\000\325\325\325\006\313\313\313\262\314\314\314\377"
  "\314\314\314\377\314\314\314\377\314\314\314\377\314\314\314\377\314\314"
  "\314\364\312\312\312?\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000!\323\261\027\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\365X'\032"
  "\371T(\256\371U(\262\377U\000\003\371W%)\371T(\343\377U+\014\000\000\000\000\000\000\000\000\325"
  "\325\325\006\313\313\313\262\314\314\314\377\314\314\314\377\314\314\314\377"
  "\314\314\314\364\312\312\312?\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\371T'\211\370"
  "T(\300\372T(\351\371T(y\377U\000\003\377P\060\020\371T(\325\371T'U\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\325\325\325\006\313\313\313\262\314\314\314\377\314\314"
  "\314\364\312\312\312?\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\373U(?\373U"
  "(\071\377U+\006\000\000\000\000\371U+*\371T(\325\371T(y\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\333\333\333\007\314\314\314\251\313\313\313;\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\377Z-\021\367R)D\370S'\234"
  "\371T(\343\371T'U\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\371T(\310\371T(\345\372U(\273\370U(l\377U+\014\000\000\000\000\000\000\000\000\000\000\000\000\000"
  "\000\000\000",
};

QualityGfx::QualityGfx(GPVideo &v, GPX *h) : Gfx( 600,300, v, h ) {
	this->calcScales();
}

void QualityGfx::calcScales( void ){
		/* Label */
	cairo_text_extents_t extents;
	cairo_t *cr = cairo_create(this->background);

	cairo_select_font_face(cr, "sans", CAIRO_FONT_SLANT_NORMAL, CAIRO_FONT_WEIGHT_BOLD);
	cairo_set_font_size(cr, 35);
	cairo_text_extents(cr, "8888 (8)", &extents);
	this->offy = extents.height + 5;
	this->posLabel = this->SX - extents.x_advance - 55;

	cairo_select_font_face(cr, "sans", CAIRO_FONT_SLANT_NORMAL, CAIRO_FONT_WEIGHT_NORMAL);
	cairo_set_font_size(cr, 27);
	cairo_text_extents(cr, "8888", &extents);
	this->offx = extents.x_advance + 10;

		/* Scales */
	this->min_h = (((int)this->video.getMin().dop)/25)*25;
	this->max_h = (((int)this->video.getMax().dop)/25 + 1)*25;
	this->scale_w = (double)(this->SX - offx)/(double)this->video.getSampleCount();

	this->range_h = this->max_h - this->min_h;
	this->scale_h = (double)(this->SY - offy)/(double)this->range_h;
	this->delta_h = ((this->range_h/5)/25)*25;
	if(!this->delta_h)
		this->delta_h = this->range_h/5;

	cairo_destroy(cr);
}

void QualityGfx::drawGPMF(cairo_t *cr, int offset, uint32_t current){
	cairo_pattern_t *pat;

	if(offset){	// drawing shadow
		cairo_set_line_width(cr, 4);
		cairo_set_source_rgba(cr, 0,0,0, 0.55);
	} else {	// drawing path
		pat = cairo_pattern_create_linear(0,0, 0,this->SY);
		cairo_pattern_add_color_stop_rgb(pat, 0, 
			this->linearcomponent(this->max_h, 150, 0, 500, 1),
			this->linearcomponent(this->max_h, 150, 1, 500, 0),
		0);
		cairo_pattern_add_color_stop_rgb(pat, 1,
			this->linearcomponent(this->min_h, 150, 0, 500, 1),
			this->linearcomponent(this->min_h, 150, 1, 500, 0),
		0);
		cairo_set_source(cr, pat);

		cairo_set_line_width(cr, 2);
	}

	for(uint32_t i = 0; i < this->video.getSampleCount(); i++){
		int x = this->offx + i*this->scale_w + offset;
		int y = this->SY - (this->video[i].dop - this->min_h)*this->scale_h + offset;

		if(!i)	/* First plot */
			cairo_move_to(cr, x, y);
		else
			cairo_line_to(cr, x, y);
	}

	if(current != uint32_t(-1))
		cairo_stroke(cr);
	else
		cairo_stroke_preserve(cr);

	if(!offset)
		cairo_pattern_destroy(pat);
}

void QualityGfx::generateBackground( void ){
	cairo_surface_t *icn = cairo_image_surface_create_for_data (
		imgSatellite.pixel_data,
	    CAIRO_FORMAT_ARGB32,
		imgSatellite.width, imgSatellite.height,
		40*4
	);
	if(cairo_surface_status(icn) != CAIRO_STATUS_SUCCESS){
		fprintf(stderr, "Creating icon : %s\n", cairo_status_to_string(cairo_surface_status(icn)));
		cairo_surface_destroy(icn);
		icn = NULL;
	}

	cairo_t *cr = cairo_create(this->background);

	cairo_select_font_face(cr, "sans", CAIRO_FONT_SLANT_NORMAL, CAIRO_FONT_WEIGHT_NORMAL);
	cairo_set_font_size(cr, 27);
	cairo_set_source_rgba(cr, 1,1,1, 0.80);	/* Set white color */
	cairo_set_line_width(cr, 1);

	char t[8];
	for(int i = this->min_h; i <= this->max_h; i += this->delta_h){
		int y = this->SY - (i-this->min_h)*this->scale_h;
		sprintf(t, "%5d", i);

		cairo_move_to(cr, 3, y);
		cairo_show_text(cr, t);
		cairo_move_to(cr, this->offx, y);
		cairo_line_to(cr, this->SX, y);
	}
	cairo_stroke(cr);

	if(icn){
		cairo_save(cr);
		cairo_set_source_surface(cr, icn, this->posLabel-imgSatellite.width, 2);
		cairo_rectangle(cr, this->posLabel-imgSatellite.width, 2, imgSatellite.width, imgSatellite.height);
		cairo_fill(cr);
		cairo_restore(cr);
	}

	this->drawGPMF(cr, 3);

	cairo_pattern_t *pat = cairo_pattern_create_linear(this->offx,this->SY - this->range_h*this->scale_h, this->offx,this->SY);
	cairo_pattern_add_color_stop_rgba(pat, 0, 0,0,0, 0.25);
	cairo_pattern_add_color_stop_rgba(pat, 1, 0,0,0, 0.05);
	cairo_set_source(cr, pat);

	cairo_line_to(cr, this->SX, this->SY);
	cairo_line_to(cr, this->offx, this->SY);
	cairo_line_to(cr, this->offx, this->SY - (this->video.getFirst().getAltitude() - this->min_h)*this->scale_h);

	cairo_fill(cr);

	cairo_pattern_destroy(pat);

	this->drawGPMF(cr, 0);

	cairo_destroy(cr);

	if(icn)
		cairo_surface_destroy(icn);
}

void QualityGfx::generateOneGfx(const char *fulltarget, char *filename, int index, GPMFdata &current){

		/*
		 * Initialise Cairo
		 */
	cairo_status_t err;

	cairo_surface_t *srf = cairo_image_surface_create(CAIRO_FORMAT_ARGB32, this->SX, this->SY);
	if(cairo_surface_status(srf) != CAIRO_STATUS_SUCCESS){
		puts("*F* Can't create Cairo's surface");
		exit(EXIT_FAILURE);
	}

	cairo_t *cr = cairo_create(srf);

	cairo_set_source_surface(cr, this->background, 0, 0);
	cairo_rectangle(cr, 0,0, this->SX, this->SY);
	cairo_fill(cr);
	cairo_stroke(cr);

		/* Display the label */
	char t[10];
	sprintf(t, "%5d (%c)", current.dop, current.gfix+'0');
	cairo_select_font_face(cr, "sans", CAIRO_FONT_SLANT_NORMAL, CAIRO_FONT_WEIGHT_BOLD);
	cairo_set_font_size(cr, 35);

	cairo_set_source_rgba(cr, 0,0,0, 0.55);
	cairo_move_to(cr, this->posLabel+2, this->offy+2);
	cairo_show_text(cr, t);
	cairo_stroke(cr);

	cairo_set_source_rgb(cr,
		this->linearcomponent(current.dop, 150, 0, 500, 1),
		this->linearcomponent(current.dop, 150, 1, 500, 0),
	0);
	cairo_move_to(cr, this->posLabel, this->offy);
	cairo_show_text(cr, t);
	cairo_stroke(cr);

		/* Display the spot */
	cairo_set_line_width(cr, 5);
	cairo_arc(cr, this->offx + index*this->scale_w, this->SY - (current.dop - this->min_h)*this->scale_h , 8, 0, 2 * M_PI);
	cairo_stroke_preserve(cr);
	cairo_set_source_rgb(cr, 0.8, 0.2, 0.2);
	cairo_fill(cr);

		/* Writing the image */
	sprintf(filename, "qual%07d.png", index);
	if(verbose)
		printf("*D* Writing '%s'\r", fulltarget);

	if((err = cairo_surface_write_to_png(srf, fulltarget)) != CAIRO_STATUS_SUCCESS){
		printf("*F* Writing surface : %s / %s\n", cairo_status_to_string(err), strerror(errno));
		exit(EXIT_FAILURE);
	}

		/* Cleaning */
	cairo_destroy(cr);
	cairo_surface_destroy(srf);
}

void QualityGfx::GenerateAllGfx( const char *fulltarget, char *filename ){
	Gfx::GenerateAllGfx( fulltarget, filename );

		/* Generate video */
	if(genvideo)
		generateVideo(fulltarget, filename, "qual", "quality");
}

double QualityGfx::linearcomponent( uint16_t val, uint16_t u1, double v1, uint16_t u2, double v2 ){
	if(u1 == u2)
		return v1;
	if(val < u1)
		return v1;
	if(val > u2)
		return v2;

	double a = (double)(v2-v1)/(double)(u2-u1);
	double b = v1 - a*u1;

	double res = a*val + b;
	if(res < 0)
		return 0;
	if(res > 255)
		return 255;
	else
		return res;
}
